name: Pruebas Automáticas de Calidad y Funcionalidad

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  # 🔍 Verificación de Código con ShellCheck
  linting:
    name: Verificación con ShellCheck
    runs-on: ubuntu-latest
    timeout-minutes: 2  # ⏳ Detiene la ejecución si tarda más de 2 minutos

    steps:
      - name: 📥 Checkout del código
        uses: actions/checkout@v3

      - name: 🔍 Instalar ShellCheck
        run: sudo apt install -y shellcheck

      - name: ✅ Ejecutar ShellCheck en el script
        run: |
          echo "Ejecutando ShellCheck en creador.sh..."
          shellcheck creador.sh || exit 1

  # 🧪 Pruebas Funcionales con Bats
  functional_tests:
    name: Pruebas Funcionales con Bats
    runs-on: ubuntu-latest
    timeout-minutes: 2  # ⏳ Límite para evitar bloqueos

    steps:
      - name: 📥 Checkout del código
        uses: actions/checkout@v3

      - name: 📂 Mostrar archivos del repositorio (Depuración)
        run: ls -lah

      - name: 🔍 Instalar Bats
        run: sudo apt install -y bats

      - name: 🧪 Ejecutar pruebas con Bats
        run: |
          echo "Ejecutando pruebas funcionales con Bats..."
          bats tests/test_subcreator.bats || exit 1
